

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Workflow Scripts &mdash; GwasQcPipeline v1.0.0a3 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Parsers" href="parsers.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> GwasQcPipeline
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/installation.html">Installing GwasQcPipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/running_pipeline.html">Running the Pipeline</a></li>
</ul>
<p class="caption"><span class="caption-text">QC Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../qc_modules/sample_level.html">Sample QC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qc_modules/variant_level.html">Variant QC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qc_modules/reporting.html">QC Report</a></li>
</ul>
<p class="caption"><span class="caption-text">Module Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/file_types.html">File Type Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/rules.html">Rule Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_docs/building_docs.html">Building Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_docs/dev_tools.html">Development Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_docs/running_tests.html">Running Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_docs/setup.html">Setting-up the Development Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_docs/writing_docs.html">Writing Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="cgr_gwas_qc.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cli.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="parsers.html">Parsers</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Workflow Scripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-cgr_gwas_qc.workflow.scripts.sample_qc_table">Sample-Level</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sample-qc-table-py">sample_qc_table.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-cgr_gwas_qc.workflow.scripts.related_subjects">Subject-Level</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#related-subjects-py">related_subjects.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="#population-qc-table-py">population_qc_table.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="#agg-population-qc-tables-py">agg_population_qc_tables.py</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GwasQcPipeline</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="cgr_gwas_qc.html">API Reference</a> &raquo;</li>
        
      <li>Workflow Scripts</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/api/workflow.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="workflow-scripts">
<h1>Workflow Scripts<a class="headerlink" href="#workflow-scripts" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-cgr_gwas_qc.workflow.scripts.sample_qc_table">
<span id="sample-level"></span><h2>Sample-Level<a class="headerlink" href="#module-cgr_gwas_qc.workflow.scripts.sample_qc_table" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sample-qc-table-py">
<h3>sample_qc_table.py<a class="headerlink" href="#sample-qc-table-py" title="Permalink to this headline">¶</a></h3>
<p>Generate the internal sample QC report.</p>
<p>This script takes various outputs from the GwasQcPipeline and
aggregates/summarizes results into an internal QC report. Here we use a
functional approach to build up the QC report. Each file has it’s own
function to parse/summarize its content. This makes it easier to add new
components or change the behavior. Search for <cite>TO-ADD</cite> comments for where you
would have to make modifications to add new components.</p>
</div>
</div>
<div class="section" id="module-cgr_gwas_qc.workflow.scripts.related_subjects">
<span id="subject-level"></span><h2>Subject-Level<a class="headerlink" href="#module-cgr_gwas_qc.workflow.scripts.related_subjects" title="Permalink to this headline">¶</a></h2>
<div class="section" id="related-subjects-py">
<h3>related_subjects.py<a class="headerlink" href="#related-subjects-py" title="Permalink to this headline">¶</a></h3>
<p>Uses IBS/IBD to identify putative relationships among subjects within a
population. Any two subjects whose <code class="docutils literal notranslate"><span class="pre">PI_HAT</span></code> is greater than the user
defined <code class="docutils literal notranslate"><span class="pre">pi_hat_threshold</span></code> [1] will be considered related.</p>
<p>Output:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">{prefix}/subjects_relatives_pi_hat_gt{pi}.csv</span></code></p>
<p>This table contains information about which subjects appear to be related
according to IBS/IBD. An arbitrary family ID is assigned to help tracking.</p>
<p>1. Uses <code class="docutils literal notranslate"><span class="pre">PI_HAT</span></code> from IBS/IBD estimation to identify pairwise groups of
related subjects.
2. Builds a graph where subjects (nodes) are connected by edges if their
<code class="docutils literal notranslate"><span class="pre">PI_HAT</span></code> was above the <code class="docutils literal notranslate"><span class="pre">pi_hat_threshold</span></code> [1].
3. Each connected subgraph is then considered a “QC_Family”.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>QC_Family_ID</strong> (<em>index</em>)</p></td>
<td><p>An arbitrary ID assigned to each related set of subjects.</p></td>
</tr>
<tr class="row-odd"><td><p>relatives</p></td>
<td><p>A list of related Subject_IDs concatenated together with a <cite>|</cite>.</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">{prefix}/subjects_to_remove_pi_hat_gt{pi}.txt</span></code></p>
<p>Using a greeding algorithm, select subjects, with the most relationships,
to prune from the dataset to eliminate relatedness.</p>
<p>1. Uses <code class="docutils literal notranslate"><span class="pre">PI_HAT</span></code> from IBS/IBD estimation to identify pairwise groups of
related subjects.
2. Builds a graph where subjects (nodes) are connected by edges if their
<code class="docutils literal notranslate"><span class="pre">PI_HAT</span></code> was above the <code class="docutils literal notranslate"><span class="pre">pi_hat_threshold</span></code> [1].
3. Identifies subjects that have the most relatives (ie., nodes with max
degree).
4. Randomly selects and removes one of these highly connected subjects.
Adds this subject to the output pruning list.
5. Removes any subjects that no longer have a relative in the graph
(i.e., isolated nodes with no edges).
6. Repeats 3-5 until there are no subjects left in the graph.</p>
<p>Saves a list of subjects to prune in a format compatible with PLINK’s
<code class="docutils literal notranslate"><span class="pre">--remove</span></code> option. In other words, a space separated table in the form
of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Subject_ID1</span>  <span class="n">Subject_ID1</span>
<span class="n">Subject_ID2</span>  <span class="n">Subject_ID2</span>
<span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
<p class="rubric">References</p>
<ul class="simple">
<li><p>[1] <code class="xref py py-attr docutils literal notranslate"><span class="pre">cgr_gwas_qc.models.config.software_params.SoftWareParams.pi_hat_threshold</span></code></p></li>
</ul>
</div>
<span class="target" id="module-cgr_gwas_qc.workflow.scripts.population_qc_table"></span><div class="section" id="population-qc-table-py">
<h3>population_qc_table.py<a class="headerlink" href="#population-qc-table-py" title="Permalink to this headline">¶</a></h3>
<p>Creates a QC summary table for each population. This is done by aggregating major population-level results including:</p>
<ul class="simple">
<li><p>Within population subject reslationships (IBS/IBD)</p></li>
<li><p>Principal components analysis</p></li>
<li><p>Autosomal heterozygosity</p></li>
</ul>
<dl>
<dt>Output:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">population_level/{population}/qc.csv</span></code></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>population</p></td>
<td><p>The population name</p></td>
</tr>
<tr class="row-odd"><td><p>Subject_ID</p></td>
<td><p>The Subject’s ID</p></td>
</tr>
<tr class="row-even"><td><p>QC_Family_ID</p></td>
<td><p>An arbitrary ID assigned to each related set of subjects.</p></td>
</tr>
<tr class="row-odd"><td><p>relatives</p></td>
<td><p>A list of related Subject_IDs concatenated together with a <cite>|</cite>.</p></td>
</tr>
<tr class="row-even"><td><p>PC1</p></td>
<td><p>Principal component 1</p></td>
</tr>
<tr class="row-odd"><td><p>PC2</p></td>
<td><p>Principal component 2</p></td>
</tr>
<tr class="row-even"><td><p>PC3</p></td>
<td><p>Principal component 3</p></td>
</tr>
<tr class="row-odd"><td><p>PC4</p></td>
<td><p>Principal component 4</p></td>
</tr>
<tr class="row-even"><td><p>PC5</p></td>
<td><p>Principal component 5</p></td>
</tr>
<tr class="row-odd"><td><p>PC6</p></td>
<td><p>Principal component 6</p></td>
</tr>
<tr class="row-even"><td><p>PC7</p></td>
<td><p>Principal component 7</p></td>
</tr>
<tr class="row-odd"><td><p>PC8</p></td>
<td><p>Principal component 8</p></td>
</tr>
<tr class="row-even"><td><p>PC9</p></td>
<td><p>Principal component 9</p></td>
</tr>
<tr class="row-odd"><td><p>PC10</p></td>
<td><p>Principal component 10</p></td>
</tr>
<tr class="row-even"><td><p>O_HOM</p></td>
<td><p>Observed number of homozygotes</p></td>
</tr>
<tr class="row-odd"><td><p>E_HOM</p></td>
<td><p>Expected number of homozygotes</p></td>
</tr>
<tr class="row-even"><td><p>N_NM</p></td>
<td><p>Number of non-missing autosomal genotypes</p></td>
</tr>
<tr class="row-odd"><td><p>F</p></td>
<td><p>Method-of-moments F coefficient estimate</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p class="rubric">References</p>
<ul class="simple">
<li><p><a class="reference internal" href="#module-cgr_gwas_qc.workflow.scripts.related_subjects" title="cgr_gwas_qc.workflow.scripts.related_subjects"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgr_gwas_qc.workflow.scripts.related_subjects</span></code></a></p></li>
<li><p><a class="reference internal" href="parsers.html#cgr_gwas_qc.parsers.plink.read_het" title="cgr_gwas_qc.parsers.plink.read_het"><code class="xref py py-func docutils literal notranslate"><span class="pre">cgr_gwas_qc.parsers.plink.read_het()</span></code></a></p></li>
<li><p><a class="reference internal" href="parsers.html#cgr_gwas_qc.parsers.eigensoft.Eigenvec" title="cgr_gwas_qc.parsers.eigensoft.Eigenvec"><code class="xref py py-class docutils literal notranslate"><span class="pre">cgr_gwas_qc.parsers.eigensoft.Eigenvec</span></code></a></p></li>
</ul>
</div>
<span class="target" id="module-cgr_gwas_qc.workflow.scripts.agg_population_qc_tables"></span><div class="section" id="agg-population-qc-tables-py">
<h3>agg_population_qc_tables.py<a class="headerlink" href="#agg-population-qc-tables-py" title="Permalink to this headline">¶</a></h3>
<p>Aggregate per population summary tables into a single table. Then add extra
metadata from the sample qc table.</p>
<dl>
<dt>Output:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">population_level/population_qc.csv</span></code></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>population</p></td>
<td><p>The population name</p></td>
</tr>
<tr class="row-odd"><td><p>Subject_ID</p></td>
<td><p>The Subject’s ID</p></td>
</tr>
<tr class="row-even"><td><p>Sample_ID</p></td>
<td><p>Sample ID</p></td>
</tr>
<tr class="row-odd"><td><p>case_control</p></td>
<td><p>Case/Control Status</p></td>
</tr>
<tr class="row-even"><td><p>QC_Family_ID</p></td>
<td><p>An arbitrary ID assigned to each related set of subjects.</p></td>
</tr>
<tr class="row-odd"><td><p>relatives</p></td>
<td><p>A list of related Subject_IDs concatenated together with a ‘|’.</p></td>
</tr>
<tr class="row-even"><td><p>PC1</p></td>
<td><p>Principal component 1</p></td>
</tr>
<tr class="row-odd"><td><p>PC2</p></td>
<td><p>Principal component 2</p></td>
</tr>
<tr class="row-even"><td><p>PC3</p></td>
<td><p>Principal component 3</p></td>
</tr>
<tr class="row-odd"><td><p>PC4</p></td>
<td><p>Principal component 4</p></td>
</tr>
<tr class="row-even"><td><p>PC5</p></td>
<td><p>Principal component 5</p></td>
</tr>
<tr class="row-odd"><td><p>PC6</p></td>
<td><p>Principal component 6</p></td>
</tr>
<tr class="row-even"><td><p>PC7</p></td>
<td><p>Principal component 7</p></td>
</tr>
<tr class="row-odd"><td><p>PC8</p></td>
<td><p>Principal component 8</p></td>
</tr>
<tr class="row-even"><td><p>PC9</p></td>
<td><p>Principal component 9</p></td>
</tr>
<tr class="row-odd"><td><p>PC10</p></td>
<td><p>Principal component 10</p></td>
</tr>
<tr class="row-even"><td><p>O_HOM</p></td>
<td><p>Observed number of homozygotes</p></td>
</tr>
<tr class="row-odd"><td><p>E_HOM</p></td>
<td><p>Expected number of homozygotes</p></td>
</tr>
<tr class="row-even"><td><p>N_NM</p></td>
<td><p>Number of non-missing autosomal genotypes</p></td>
</tr>
<tr class="row-odd"><td><p>F</p></td>
<td><p>Method-of-moments F coefficient estimate</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p class="rubric">References</p>
<ul class="simple">
<li><p><a class="reference internal" href="#module-cgr_gwas_qc.workflow.scripts.sample_qc_table" title="cgr_gwas_qc.workflow.scripts.sample_qc_table"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgr_gwas_qc.workflow.scripts.sample_qc_table</span></code></a></p></li>
<li><p><a class="reference internal" href="#module-cgr_gwas_qc.workflow.scripts.related_subjects" title="cgr_gwas_qc.workflow.scripts.related_subjects"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgr_gwas_qc.workflow.scripts.related_subjects</span></code></a></p></li>
<li><p><a class="reference internal" href="parsers.html#cgr_gwas_qc.parsers.plink.read_het" title="cgr_gwas_qc.parsers.plink.read_het"><code class="xref py py-func docutils literal notranslate"><span class="pre">cgr_gwas_qc.parsers.plink.read_het()</span></code></a></p></li>
<li><p><a class="reference internal" href="parsers.html#cgr_gwas_qc.parsers.eigensoft.Eigenvec" title="cgr_gwas_qc.parsers.eigensoft.Eigenvec"><code class="xref py py-class docutils literal notranslate"><span class="pre">cgr_gwas_qc.parsers.eigensoft.Eigenvec</span></code></a></p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="parsers.html" class="btn btn-neutral float-left" title="Parsers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Leidos Biomedical Research, Inc.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>