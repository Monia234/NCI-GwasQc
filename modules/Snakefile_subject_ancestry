#!/usr/bin/python

rule ancestry_plot:
    input:
        'ancestry/subjects.snpweights.csv'
    output:
        png = 'ancestry/subjects.ancestry.png',
        R = 'ancestry/subjects.ancestry.R',
        Rout = 'ancestry/subjects.ancestry.R.out'
    run:
        rTxt = '''
        require(plotrix)
        colors <- c(rgb(0, 0, 1, .3), rgb(1, 0, 0, .3), rgb(.75, .75, .75, .3), rgb(0, 1, 0, .3))
        data <- read.csv("''' + input[0] + '''")
        data$total=data$EUR+data$AFR+data$ASN         # Need to account
        data$European=data$EUR/data$total             # for slight rounding
        data$African=data$AFR/data$total              # in the ancestry
        data$Asian=data$ASN/data$total
        data_p=data[c("European","Asian","African")]  # triax.plot to work
        png("''' + output.png + '''", 6.5, 6.5, "in", res = 300)
        triax.plot(data_p, pch=20, col.symbol = colors[data$CaCo + 1], cc.axes=T, show.grid=T)
        legend("topleft", legend = c("Cases", "Controls", "Unknown"), col = c("red", "blue", "green"), pch = 19)
        dev.off()
        '''
        with open(output.R, 'w')  as R:
            R.write(rTxt)
        shell('R --vanilla < {output.R} > {output.Rout}')


